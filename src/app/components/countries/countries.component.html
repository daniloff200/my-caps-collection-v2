<div class="countries-page">
  <div class="countries-page__header">
    <h1 class="countries-page__title">{{ 'COUNTRIES.TITLE' | translate }}</h1>
    <p class="countries-page__subtitle">
      <span class="countries-page__number">{{ totalCaps }}</span> {{ 'COUNTRIES.CAPS_IN' | translate }}
      <span class="countries-page__number">{{ totalCountries }}</span> {{ 'COUNTRIES.COUNTRIES_LABEL' | translate }}
    </p>
  </div>

  <!-- Interactive World Map -->
  <app-world-map (countryClick)="onMapCountryClick($event)"></app-world-map>

  <!-- Unknown block -->
  <div class="country-block country-block--unknown" *ngIf="unknownCaps.length">
    <div class="country-block__header" (click)="toggleCountry('Unknown')">
      <div class="country-block__left">
        <span class="country-block__icon">‚ùì</span>
        <span class="country-block__name">{{ 'COUNTRIES.UNKNOWN' | translate }}</span>
      </div>
      <div class="country-block__right">
        <span class="country-block__count">{{ unknownCaps.length }}</span>
        <span class="country-block__arrow" [class.country-block__arrow--open]="isExpanded('Unknown')">‚ñ∏</span>
      </div>
    </div>
    <div class="country-block__caps" *ngIf="isExpanded('Unknown')">
      <a
        *ngFor="let cap of unknownCaps"
        [routerLink]="['/cap', cap.id]"
        class="country-cap"
      >
        <div class="country-cap__image">
          <img *ngIf="cap.imageUrl" [src]="cap.imageUrl" [alt]="cap.name" />
          <span *ngIf="!cap.imageUrl" class="country-cap__placeholder">üç∫</span>
        </div>
        <span class="country-cap__name">{{ cap.name }}</span>
      </a>
    </div>
  </div>

  <!-- Country groups -->
  <div
    class="country-block"
    *ngFor="let group of countryGroups"
  >
    <div class="country-block__header">
      <div class="country-block__left" (click)="toggleCountry(group.country)">
        <span class="country-block__flag">{{ group.country | countryFlag }}</span>
        <span class="country-block__name">{{ group.country }}</span>
      </div>
      <div class="country-block__right">
        <span class="country-block__count">{{ group.count }}</span>
        <a
          class="country-block__link"
          (click)="navigateToCountry(group.country)"
          title="{{ group.country }}"
        >‚Üí</a>
        <span
          class="country-block__arrow"
          [class.country-block__arrow--open]="isExpanded(group.country)"
          (click)="toggleCountry(group.country)"
        >‚ñ∏</span>
      </div>
    </div>
    <div class="country-block__caps" *ngIf="isExpanded(group.country)">
      <a
        *ngFor="let cap of group.caps"
        [routerLink]="['/cap', cap.id]"
        class="country-cap"
      >
        <div class="country-cap__image">
          <img *ngIf="cap.imageUrl" [src]="cap.imageUrl" [alt]="cap.name" />
          <span *ngIf="!cap.imageUrl" class="country-cap__placeholder">üç∫</span>
        </div>
        <span class="country-cap__name">{{ cap.name }}</span>
      </a>
    </div>
  </div>

  <!-- Empty state -->
  <div class="countries-empty" *ngIf="!countryGroups.length && !unknownCaps.length">
    <p>{{ 'COUNTRIES.EMPTY' | translate }}</p>
  </div>
</div>
