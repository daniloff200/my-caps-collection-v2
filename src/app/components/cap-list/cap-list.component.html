<div class="collection">
  <!-- Search -->
  <div class="search-box">
    <span class="search-box__icon">üîç</span>
    <input
      type="text"
      class="search-box__input"
      [placeholder]="'LIST.SEARCH_PLACEHOLDER' | translate"
      [ngModel]="filters.search"
      (ngModelChange)="onSearchChange($event)"
    />
    <button
      *ngIf="filters.search"
      class="search-box__clear"
      (click)="onSearchChange('')"
    >√ó</button>
  </div>

  <!-- Filter Bar -->
  <div class="collection__toolbar">
    <button
      class="btn btn--trade"
      [class.btn--trade-active]="filters.forTrade === true"
      (click)="toggleForTrade()"
    >
      üîÑ {{ 'LIST.FOR_TRADE' | translate }}
    </button>

    <button
      class="btn btn--outline"
      [class.btn--active]="showFilters"
      (click)="toggleFilters()"
    >
      <span>{{ 'LIST.FILTERS' | translate }}</span>
      <span *ngIf="hasActiveFilters" class="btn__badge">!</span>
    </button>

    <button
      *ngIf="hasActiveFilters"
      class="btn btn--ghost"
      (click)="resetFilters()"
    >
      {{ 'LIST.CLEAR_ALL' | translate }}
    </button>
  </div>

  <!-- Tags quick filter -->
  <div class="tags-bar" *ngIf="allTags.length">
    <app-tag-badge
      *ngFor="let tag of allTags"
      [tag]="tag"
      [clickable]="true"
      [active]="filters.tag === tag"
      (tagClick)="onTagClick($event)"
    ></app-tag-badge>
  </div>

  <!-- Filter Panel -->
  <div class="filters" *ngIf="showFilters">
    <div class="filters__row">
      <div class="filters__group">
        <label class="filters__label">{{ 'LIST.COUNTRY' | translate }}</label>
        <select
          class="filters__select"
          [ngModel]="filters.country"
          (ngModelChange)="onCountryChange($event)"
        >
          <option value="">{{ 'LIST.ALL_COUNTRIES' | translate }}</option>
          <option *ngFor="let country of allCountries" [value]="country">
            {{ country }} {{ country | countryFlagEmoji }}
          </option>
        </select>
      </div>

      <div class="filters__group">
        <label class="filters__label">{{ 'LIST.TRADE_STATUS' | translate }}</label>
        <select
          class="filters__select"
          [ngModel]="tradeFilterValue"
          (ngModelChange)="onTradeFilterChange($event)"
        >
          <option value="">{{ 'LIST.ALL_CAPS' | translate }}</option>
          <option value="true">{{ 'LIST.FOR_TRADE_OPTION' | translate }}</option>
          <option value="false">{{ 'LIST.NOT_FOR_TRADE' | translate }}</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Results Count + Sort -->
  <div class="collection__meta">
    <span class="collection__count">
      {{ 'LIST.CAPS_FOUND' | translate:{ count: filteredCaps.length } }}
    </span>
    <div class="collection__sort">
      <select
        class="sort-select"
        [ngModel]="filters.sort"
        (ngModelChange)="onSortChange($event)"
      >
        <option value="newest">{{ 'LIST.SORT_NEWEST' | translate }}</option>
        <option value="oldest">{{ 'LIST.SORT_OLDEST' | translate }}</option>
        <option value="name_asc">{{ 'LIST.SORT_NAME_AZ' | translate }}</option>
        <option value="name_desc">{{ 'LIST.SORT_NAME_ZA' | translate }}</option>
        <option value="country">{{ 'LIST.SORT_COUNTRY' | translate }}</option>
      </select>
    </div>
  </div>

  <!-- Grid -->
  <div class="collection__grid" *ngIf="filteredCaps.length; else emptyState">
    <app-cap-card
      *ngFor="let cap of paginatedCaps; trackBy: trackByCap"
      [cap]="cap"
    ></app-cap-card>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button
      class="pagination__btn"
      [disabled]="currentPage === 1"
      (click)="goToPage(currentPage - 1)"
    >‚Äπ</button>

    <ng-container *ngFor="let page of visiblePages; let i = index">
      <!-- Gap indicator -->
      <span
        class="pagination__dots"
        *ngIf="i > 0 && page - visiblePages[i - 1] > 1"
      >‚Ä¶</span>

      <button
        class="pagination__btn"
        [class.pagination__btn--active]="page === currentPage"
        (click)="goToPage(page)"
      >{{ page }}</button>
    </ng-container>

    <button
      class="pagination__btn"
      [disabled]="currentPage === totalPages"
      (click)="goToPage(currentPage + 1)"
    >‚Ä∫</button>
  </div>

  <ng-template #emptyState>
    <div class="empty">
      <div class="empty__icon">üîç</div>
      <h3 class="empty__title">{{ 'LIST.NO_CAPS' | translate }}</h3>
      <p class="empty__text">{{ 'LIST.NO_CAPS_HINT' | translate }}</p>
      <button class="btn btn--primary" (click)="resetFilters()">{{ 'LIST.CLEAR_FILTERS' | translate }}</button>
    </div>
  </ng-template>
</div>
